## Ë°®Á¥ô

---
## Ê¥ªÂãïËÉåÊôØ„Å®Ê¶ÇË¶Å

- 
---
## „Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Å®Á∂ôÁ∂öÁöÑ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞
---
### „Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞
> „Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Å®„ÅØ„Ç≥„Éº„Éâ„ÅÆÂãïÁöÑÂàÜÊûê„ÅÆ‰∏ÄÁ®Æ„Åß„Åô„ÄÇ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÂÆüË°åÊôÇ„Å´„Åù„ÅÆÁâπÊÄß„Çí„Ç≠„É£„Éó„ÉÅ„É£„Åó„ÄÅ„Åì„ÅÆÊÉÖÂ†±„Çí‰ΩøÁî®„Åó„Å¶„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÈÄüÂ∫¶„Å®ÂäπÁéá„ÇíÊîπÂñÑ„Åô„ÇãÊñπÊ≥ï„ÇíË¶ã„Å§„Åë„Åæ„Åô„ÄÇ

---

> „Åì„Çå„Åæ„Åß„ÄÅ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„ÅØ„Ç¢**„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÁô∫ÊôÇ„Å´„ÅÆ„Åø**ÂÆüË°å„Åï„Çå„Å¶„ÅÑ„Åæ„Åó„Åü„ÄÇ„Åì„ÅÆ„Ç¢„Éó„É≠„Éº„ÉÅ„Åß„ÅØ„ÄÅÊú¨Áï™Áí∞Â¢É„ÇíÊ≠£Á¢∫„Å´‰∫àÊ∏¨„Åß„Åç„ÇãË≤†Ëç∑„ÉÜ„Çπ„Éà„Å®„Éô„É≥„ÉÅ„Éû„Éº„ÇØ„ÇíÈñãÁô∫„Åß„Åç„Å™„Åë„Çå„Å∞„Å™„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ

https://cloud.google.com/profiler/docs/concepts-profiling

---
#### Êú¨Áï™Áí∞Â¢É„Åß„ÅÆ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„ÅåÊªÖÂ§ö„Å´„ÇÑ„Çâ„Å™„ÅÑÁêÜÁî±
- „Çà„ÅÑ„ÉÑ„Éº„É´„Åå„Å™„Åã„Å£„Åü
	- „Éá„Éº„ÇøÂèñÂæó„ÅÆËá™ÂãïÂåñ„Åå„Åß„Åç„Å™„ÅÑ
	- Ë®àÊ∏¨„Å´„Çà„ÇãÊú¨Áï™„Ç∑„Çπ„ÉÜ„É†„ÅÆÊÄßËÉΩ„Å´‰∏é„Åà„Å¶„Åó„Åæ„ÅÜÂΩ±Èüø„ÅåÂ§ß„Åç„ÅÑ
- Êú¨Áï™Áí∞Â¢É„Å∏„ÅÆÊé•Á∂ö„ÇíË¶Å„Åô„Çã„Åü„ÇÅ„ÅÆÊ®©Èôê„Å®Ë≤¨‰ªªÂïèÈ°å
- ÂΩìÊôÇÂÆöÁæ©„Åó„ÅüÊÄßËÉΩË¶Å‰ª∂ÈÄö„Çä‰Ωú„Å£„Å¶Ë©¶È®ì„ÅåÈÄö„Çå„Å∞„ÄÅÊú¨Áï™„ÇÇ„Åù„ÅÆ„Åæ„ÅæÂãï„Åë„ÇãËø∑‰ø° 

---

### Á∂ôÁ∂öÁöÑ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞
> Á∂ôÁ∂öÁöÑ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Å®„ÅØ„ÄÅ**Êú¨Áï™Áí∞Â¢É**„ÅßÂÆüË°å‰∏≠„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Çí„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Åô„Çã„Åì„Å®„Åß„Åô„ÄÇ„Åì„ÅÆ„Ç¢„Éó„É≠„Éº„ÉÅ„Å´„Çà„Çä„ÄÅÊú¨Áï™Áí∞Â¢É„ÅÆÊ≠£Á¢∫„Å™‰∫àÊ∏¨Ë≤†Ëç∑„ÉÜ„Çπ„Éà„Å®„Éô„É≥„ÉÅ„Éû„Éº„ÇØ„ÅÆÈñãÁô∫„Åå‰∏çË¶Å„Å´„Å™„Çä„Åæ„Åô„ÄÇÁ∂ôÁ∂öÁöÑ„Å™„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Å´Èñ¢„Åô„ÇãË™øÊüª„Åß„ÄÅ„Åù„ÅÆÈ´ò„ÅÑÊ≠£Á¢∫ÊÄß„Å®Ë≤ªÁî®ÂØæÂäπÊûú„ÅåË®ºÊòé„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ

https://cloud.google.com/profiler/docs/concepts-profiling

---

#### Âà©ÁÇπ
![](https://grafana.com/static/img/pyroscope/profiling-use-cases-diagram.png)

---
## Á∂ôÁ∂öÁöÑ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„ÅÆÂÆüË∑µÔºà„ÉÑ„Éº„É´Á∑®Ôºâ
---
### ‰∫àÂÇôÁü•Ë≠ò
#### „Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Éá„Éº„Çø(Profiling data)
- CPU 
- Memory
- Disk I/O Requests
---
#### „Éá„Éº„Çø„ÅÆÂèñÂæóÔºö„Éó„É≠„Éï„Ç°„Ç§„É©„Éº(Profiler)
- „Çø„Éº„Ç≤„ÉÉ„Éà„Åã„Çâ„Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞„Éá„Éº„Çø„ÇíÂèéÈõÜ„Åô„Çã„Éó„É≠„Ç∞„É©„É†
- „Çµ„É≥„Éó„É™„É≥„Ç∞ÊñπÂºè„Åå‰∏ªÊµÅ„Å´„Å™„Å£„Åü„ÄÇÔºà„Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆÊÄßËÉΩ„Å´‰∏é„Åà„ÇãÂΩ±Èüø„ÅåÂ∞è„Åï„ÅÑÔºâ
- Java: [Flight Recorder](https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/about.htm#JFRUH170), [VisualVM (OSS)](https://visualvm.github.io/download.html), [JProfiler (commercial)](https://www.ej-technologies.com/products/jprofiler/overview.html)
- Golang: [pprof](https://github.com/google/pprof)
---
#### „Éá„Éº„Çø„ÅÆÂèØË¶ñÂåñÔºö„Éï„É¨„Éº„É†„Ç∞„É©„Éï(Flamegraph)üî•
---
> „ÄåÊàë„ÅåÂ§¢„ÅØ„ÄÅ„Åô„Åπ„Å¶„ÅÆÊÄßËÉΩ„ÇíÂÆåÂÖ®„Å´ÁêÜËß£„Åô„Çã„Åì„Å®„Å†ÔºÅ„Äç -- Brendan Gregg, Flamegraph Áô∫ÊòéËÄÖ & *Ë©≥Ëß£ „Ç∑„Çπ„ÉÜ„É†„Éª„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ* ËëóËÄÖ

![[Brendan GreggÂêçË®Ä.png|500]]

---

![|500](https://grafana.com/static/img/pyroscope/code-to-flamegraph-animation.gif)

---
- Tools provided by Cloud Vendors
	- [GCP Cloud Profiler](https://cloud.google.com/profiler/docs/about-profiler) 
	- [Azure Monitor Application Insights](https://learn.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview) 
	- [AWS CodeGuru Profiler](https://docs.aws.amazon.com/codeguru/latest/profiler-ug/what-is-codeguru-profiler.html) 
	- ...
- Tools provided by O11y tool vendors
	- Datadog: https://docs.datadoghq.com/profiler/
	- Elastic: https://www.elastic.co/observability/universal-profiling
	- ...
---
- Tools provided by OSS
![|500](https://user-images.githubusercontent.com/23323466/192879029-f10378ca-1b88-4441-9cf4-ba24b6f62256.png)
#### Grafana Pyroscope

---
##### Ë®àË£ÖÊñπÊ≥ï
![|500](https://grafana.com/media/docs/pyroscope/pyroscope_client_server_diagram.png)

---
##### Deployment modes
- Monolithic mode vs Microservices mode

| ![\|300](https://grafana.com/docs/pyroscope/latest/reference-pyroscope-architecture/deployment-modes/monolithic-mode.svg) | ![\|300](https://grafana.com/docs/pyroscope/latest/reference-pyroscope-architecture/deployment-modes/microservices-mode.svg) |
| ------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |

---

### Grafana Pyroscope Demo


---
## Future Trends
---
### Profiling üíñ OTel
- Profiling as OTel's fourth signal
	- [Data model merged](https://github.com/open-telemetry/oteps/pull/239)
	- Next steps: Collector implementation, API Specification, SDK Specification, ...
	- [Elastic's Continuous Profiling Agent Donation Proposal](https://github.com/open-telemetry/community/issues/1918)
- [For more info: OTel Profiling SIG Meeting Notes](https://docs.google.com/document/d/19UqPPPlGE83N37MhS93uRlxsP1_wGxQ33Qv6CDHaEp0/edit)
---
### Profiling üíñ  ![|200](https://ebpf.io/static/logo-black-98b7a1413b4a74ed961d292cf83da82e.svg)
- Êã°ÂºµBPFÔºàeBPFÔºâ„ÅØLinux„Ç´„Éº„Éç„É´„É¨„Ç§„É§„Éº„ÅßËªΩÈáè„Å™„Çµ„É≥„Éâ„Éú„ÉÉ„ÇØ„Çπ„Åï„Çå„Åü‰ªÆÊÉ≥„Éû„Ç∑„É≥„Åß„ÅÇ„Çä„ÄÅ„Ç´„Éº„Éç„É´„ÅÆ„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„ÇíÂ§âÊõ¥„Åõ„Åö„Å´„ÄÅÊú¨Êù•„É¶„Éº„Ç∂„Çπ„Éö„Éº„Çπ„Åß„Åó„ÅãÂÆüË£Ö„Åß„Åç„Å™„ÅÑ„Éó„É≠„Ç∞„É©„É†„ÇíÂäπÁéáÁöÑ„Å´ÂÆüË°å„Åß„Åç„ÇãÊäÄË°ì„ÄÇ
- 
---
#### Ë®ÄË™û„Åî„Å®„Å´‰Ωø„ÅÑÂàÜ„Åë

| Ë®ÄË™û„Çø„Ç§„Éó | „Ç≥„É≥„Éë„Ç§„É´ÂûãË®ÄË™û(e.g. Golang, Java) | „Ç§„É≥„Çø„Éó„É™„ÇøÂûãË®ÄË™û(e.g. Python, Ruby) |
| ----- | --------------------------- | ---------------------------- |
| Êé®Â•®    | eBPF„Éó„É≠„Éï„Ç°„Ç§„É©„Éº                 | ÈùûeBPF„Éó„É≠„Éï„Ç°„Ç§„É©„Éº                 |
| ÁêÜÁî±    | ÈùûeBPF„Éó„É≠„Éï„Ç°„Ç§„É©„Éº„Å®‰ºº„Å¶„ÅÑ„ÇãÊÉÖÂ†±„ÅåÂèñÂæó„Åß„Åç„Çã   |                              |


> When profiling „Ç≥„É≥„Éë„Ç§„É´ÂûãË®ÄË™û, like Golang, the eBPF profiler is able to get very similar information to the non-eBPF profiler.
> 
> With interpreted languages like Ruby or Python, stacktraces in their runtimes are not easily accessible from the kernel. As a result, the eBPF profiler is not able to parse user-space stack traces for interpreted languages.

https://pyroscope.io/blog/ebpf-profiling-pros-cons/

---
- https://grafana.com/docs/pyroscope/latest/configure-client/grafana-agent/ebpf/
	- eBPF to profile the node(e.g. k8s cluster) 
	- specific language instrumentation per application
---
- Elastic Universal Profiling: https://www.elastic.co/observability/universal-profiling
---
### Profiling üíñ AI
- AI-Powered Flamegraph Interpreter in Grafana Pyroscope
https://pyroscope.io/blog/ai-powered-flamegraph-interpreter/

---
## Off-Topic
---
### [Efficient Go Japanese release Feb.24th ](https://www.oreilly.co.jp/books/9784814400539/)
![|500](https://www.oreilly.co.jp/books/images/picture_large978-4-8144-0053-9.jpeg)

---
### ÂäπÁéáÂåñ„Éï„Çß„Éº„Ç∫„Å´„Åä„Åë„ÇãO11y
![[Efficiency-aware development flow(Efficiency phase focused).png|500]]

---
### (Who still needs to read this?) 
![[juku_off_topic_meme.JPG|500]]

---

## Other References
- https://www.infoq.com/articles/open-source-java-profilers/
- https://grafana.com/docs/pyroscope/latest/introduction/flamegraphs/
- [Continuous Profiling is proposed by Google, 1997](https://dl.acm.org/doi/10.1145/265924.265925)
- [Continuous Profiling in production by Google, 2010](https://research.google/pubs/google-wide-profiling-a-continuous-profiling-infrastructure-for-data-centers/)
- https://pyroscope.io/blog/ebpf-profiling-pros-cons/